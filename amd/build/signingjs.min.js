define(["jquery"],function(e){var f;var d,c;var a;var b;return{init:function(){initialize()},save:function(){initialize()}}});function initialize(e){canvas=document.getElementById("canvas-"+e);ctx=canvas.getContext("2d");var i=canvas.getBoundingClientRect();canvas.width=i.width;canvas.height=i.height;ctx.strokeStyle="#000";ctx.lineWidth=1;var j=false;var k={x:0,y:0};var h=k;var g=("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch;$("#clearCanvas-"+e).bind("click",function(){l(canvas,ctx)});$("#id_submitbutton-"+e).click(function(){var m=$("#contextid-"+e).val();var o=$("#subkey-"+e).val();var n=$("#canvas-"+e)[0].toDataURL();$("#id_signing-"+e).val(n);require(["core/ajax"],function(p){p.call([{methodname:"filter_signature_sign",args:{contextid:m,subkey:o,signature:n},done:function(){},fail:function(){}}])})});canvas.addEventListener((g?"touchstart":"mousedown"),function(m){m.preventDefault();m.stopPropagation();j=true;h=c(canvas,m);k=h});canvas.addEventListener((g?"touchmove":"mousemove"),function(m){m.preventDefault();m.stopPropagation();k=c(canvas,m)});canvas.addEventListener((g?"touchend":"mouseup"),function(m){m.preventDefault();m.stopPropagation();j=false});document.body.addEventListener("touchstart",function(m){if(m.target==canvas){m.preventDefault();m.stopPropagation()}},false);document.body.addEventListener("touchend",function(m){if(m.target==canvas){m.preventDefault();m.stopPropagation()}},false);document.body.addEventListener("touchmove",function(m){if(m.target==canvas){m.preventDefault();m.stopPropagation()}},false);function c(m,n){var o=m.getBoundingClientRect();return{x:(g?n.touches[0].clientX:n.clientX)-o.left,y:(g?n.touches[0].clientY:n.clientY)-o.top}}window.requestAnimFrame=(function(m){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1000/60)}})();function a(){if(j){ctx.moveTo(h.x,h.y);ctx.lineTo(k.x,k.y);ctx.stroke();h=k}}(function b(){requestAnimFrame(b);a()})();$(window).resize(function(){var m=canvas.width,o=canvas.height;var n=ctx.getImageData(0,0,m,o);var p=canvas.getBoundingClientRect();canvas.width=p.width;canvas.height=p.height;m=canvas.width,o=canvas.height;ctx.putImageData(n,0,0)});function l(n,m){m.clearRect(0,0,n.width,n.height);n.width=n.width}function d(m){this.href=m.toDataURL()}function f(){this.href=canvas.toDataURL();if(this.href==document.getElementById("blank").toDataURL()){$("#signing_text").val("")}else{$("#signing_text").val("this.href")}}};